---
layout: post
title: SD
date: 2025-06-15 19:48 -0500
author: nooneswarup
categories: [Prep, SD]
tags: [sd]  
---


1. Functional Requirements
	Define the scope by asking questions
2. Non-Functional Requirements
	Latency: What is the maximum acceptable delay?
	Availability: highly availability? or not?
	Consistency: strong vs eventual consistency? *different services
	Durability: Should data, once saved, be permanent?
	Scalability: How will the system handle growth in users, data, and traffic?
	
	CAP Theorem: a system can only guarantee two of the following three properties during a network failure:
    - **Consistency:** Every read receives the most recent write or an error.
    - **Availability:** Every request receives a (non-error) response, without the guarantee that it contains the most recent write.
    - **Partition Tolerance:** The system continues to operate despite network partitions (messages being dropped or delayed between nodes).
    - **Rule of Thumb:** Since network failures are inevitable in distributed systems, choose between prioritizing Consistency or Availability.
3. Estimation & Back-of-the-Envelope Math
	Daily Active Users (DAU): 30% of Monthly Active Users (MAU)
	Read/Write Ratio
	Peak Traffic: 2x- 5x the average daily traffic.
	Data Retention: 3-5 years
	Replication: 3 replicas for durability
	
	Time: 1 day â‰ˆ 100,000 seconds (actually 86,400).
	Data Sizes:
    - `kb` (kilobyte) = 10^3 bytes
    - `mb` (megabyte) = 10^6 bytes
    - `gb` (gigabyte) = 10^9 bytes
    - `tb` (terabyte) = 10^12 bytes
    - `pb` (petabyte) = 10^15 bytes
    Traffic Estimates (QPS):
    - Write QPS = (Total Write Requests per Day) / (Seconds in a Day)
    - Read QPS = (Total Read Requests per Day) / (Seconds in a Day)
	Storage Estimates:
    - Storage per Day = (Number of Users) * (Writes per User per Day) * (Size per Write)
    - Total Storage = (Storage per Day) * (365 days) * (Retention Period in Years) * (Number of Replicas)
	Memory Estimates (for Cache):
    - Identify data for caching (e.g., hot read items).
    - Cache Size = (Number of Items to Cache) * (Average Size per Item)
    - Apply the 80/20 rule: 20% of the data often generates 80% of the traffic.
4. HLD
	Reverse Proxy: Hides server addresses, can handle SSL termination, compression.
	Load Balancer: Distributes traffic across servers to ensure no single server is a bottleneck.
    - **Types:** Active-Passive, Active-Active
    - **Layers:** Layer 4 (TCP level), Layer 7 (HTTP level, allows for smarter routing)
    API Gateway: A single entry point for all clients. AWS API Gateway, Kong.
    - Authentication, Authorization, API Routing, Monitoring, Rate Limiting, Logging.
    Caching Strategies
    Caches store frequently accessed or expensive-to-compute data in memory for fast lookups
    Cache Layers: Browser, CDN, Webserver, Application, Databases
	Cache Invalidation & Eviction Policies:
    - **Cache Aside:** The application is responsible for reading/writing from storage and updating the cache.
    - **Write-Through:** The application writes to the cache, and the cache writes to the database. Ensures consistency but adds write latency.
    - **Write-Behind:** The application writes to the cache, which acknowledges immediately and updates the database asynchronously. Fast writes, but risk of data loss if the cache fails.
	Distributed Cache: Redis, Memcached.
	CDN (Content Delivery Network): Caches static assets (JS, CSS, HTML, videos, images) at edge locations closer to users for lower latency. The CDN pulls from an origin like AWS S3.
    - **Examples:** Cloudflare, AWS CloudFront.
5. Databases
	Relational (SQL): Good for structured data requiring ACID transactions, complex queries.
	NoSQL:
    - **Key-Value:** DynamoDB, Redis. Fast lookups based on a key.
    - **Document:** MongoDB. Stores data in flexible JSON-like documents.
    - **Graph:** Neo4j. For data with complex relationships (e.g., social networks).
	Search Engine: Elasticsearch. For full-text search capabilities.
	In-Memory Database: Redis. Used for caching, session management, and real-time applications.
	Queue: Acts as a buffer to decouple services and handle load spikes.
	    - **Examples:** AWS SQS, RabbitMQ.
	        
	Stream/Event Processing: Process data in near-real-time.
	    - **Examples:** Kafka, Flink.
	Change Data Capture (CDC): Captures changes from a database and streams them to other systems.
    Object Storage (**AWS S3**): For unstructured data like videos, images, and static files. You get a URL linked to the object.    
	
	PostgreSQL 
	- **Model:** Tables, rows, columns with a predefined schema.
	- **Indexes:** Primary key, secondary key, multi-column indexes.
	- **Consistency:** Strong consistency by default. Can configure synchronous or asynchronous replication.
	- **Pros:**
	    1. Full ACID compliance.
	    2. Excellent for complex queries, joins, and stored procedures.
	    3. Open source and highly extensible.
	    4. Mature and reliable.
	- **Cons:**
	    1. Horizontal scaling (sharding) is complex and often managed manually.
	    2. Flexible schema changes are difficult.
	    3. Can be costly to achieve high availability if self-managed.
	- **Managed Solution:** AWS RDS.
	
	DynamoDB 
	- **Model:** Tables, items (rows), and attributes (columns). Schema-less.
	- **Indexes:**
	    - **Partition Key:** Mandatory, determines the physical partition where data is stored.
	    - **Sort Key:** Optional, data is sorted by this key within a partition.
	    - **Secondary Indexes:** GSI (Global Secondary Index - different partition key), LSI (Local Secondary Index - same partition key).
	- **Pros:**
	    1. Fully managed by AWS, providing massive, seamless scalability.
	    2. Supports ACID transactions.
	    3. Built-in Change Data Capture (DynamoDB Streams).
	    4. Optional strong consistency on reads (at higher latency).
	    5. DAX (DynamoDB Accelerator) provides a tightly integrated in-memory cache.
	- **Cons:**
	    1. Not suitable for complex queries or joins.
	    2. Can be expensive, especially with many secondary indexes.
	    3. Vendor lock-in with AWS.
	
	AWS S3 (Cloud Object Storage)
	- **Use Case:** Store large files, images, videos, logs, and other static assets.
	- **Features:**
	    1. **Multi-part Upload:** Use the AWS API to upload large files in smaller, parallel chunks for speed and reliability.
	    2. **Pre-signed URLs:** Generate temporary, secure URLs that grant a user permission to upload or download a specific object directly, without needing AWS credentials. This offloads bandwidth from your backend servers.
	    3. **S3 Notifications:** Automatically trigger a backend process (e.g., a Lambda function) when a file is uploaded, allowing you to update metadata in your primary database.
	    4. **Compression & Transcoding:** Can be done on the client-side before upload to save space and bandwidth.
	
	Kafka (Distributed Event Streaming)
	- **Use Case:** High-throughput, durable message queue or a real-time stream processing system.
	- **Core Concepts:**
	    - **Producer:** Application that writes messages (events).
	    - **Consumer:** Application that reads messages.
	    - **Consumer Group:** A group of consumers that work together to process messages from a topic. Kafka guarantees that each message is delivered to only _one_ consumer within the group.
	    - **Topic:** A category or feed name to which messages are published.
	    - **Broker:** An individual Kafka server that stores data.
	    - **Partition:** A topic is split into multiple partitions. Each partition is an ordered, immutable sequence of messages. This allows for parallel processing and scalability.
6. Monitoring, Logging & Alerting
	Monitoring: Track system health and performance.
    - **Infrastructure:** CPU, memory (e.g., Prometheus)
    - **Services:** Latency, throughput
    - **Application:** Number of users, sessions
    - **Visualization:** Grafana
	Logging: Aggregate and analyze logs from all services.
    - **Example:** ELK Stack (Elasticsearch, Logstash, Kibana).
	Alerting: Notify developers (e.g., via Slack) or users when issues arise.
7. Networking Fundamentals
	- **Protocols:**
	    - **IP (Internet Protocol):** Provides unique addressing for devices (IPv4 - 32bit, IPv6 - 128bit).
	    - **TCP (Transport Layer):** Guarantees complete and correct data delivery (e.g., HTTP).
	    - **UDP (Transport Layer):** Fast but less reliable; for live video, gaming.
	    - **HTTP (Application Layer):** The foundation of data communication for the web.
	    - **WebSockets:** For persistent, real-time, two-way connections (live chat, stock trading).
	    - **WebRTC:** For peer-to-peer browser communication (video chat).
	- **DNS (Domain Name System):** Translates human-readable domain names (e.g., google.com) to IP addresses.
	- **Common Ports:**
	    - HTTP: 80
	    - HTTPS: 443
	    - SSH: 22
	- **Common HTTP Status Codes:**
	    - **2xx Success:** 200 OK
	    - **3xx Redirection:** 301 Moved Permanently
	    - **4xx Client Error:** 400 Bad Request, 401 Unauthorized, 404 Not Found
	    - **5xx Server Error:** 500 Internal Server Error
8. API Design
	- **Paradigms:**
	    - **REST API:** Standard for web services, uses HTTP methods (GET, POST, PUT, DELETE).
	    - **GraphQL:** Allows clients to request exactly the data they need.
	    - **gRPC:** High-performance RPC (Remote Procedure Call) framework.
	- **Best Practices:**
	    - **Versioning:** (e.g., `/api/v1/...`) to ensure backward compatibility.
	    - **Pagination:** Use `limit` and `offset` (or cursor-based) to handle large result sets.
	    - **Filtering:** Allow filtering by parameters like `start_date`, `end_date`.
	    - **Rate Limiting:** Protect your service from DoS attacks and abuse.
	    - **CORS (Cross-Origin Resource Sharing):** Securely allow requests from different domains.
9. SD common designs
	1. web crawler
	2. rate limiter
	3. cache
	4. message queue
	5. online bookstore
	6. e-commerce website (e.g., Amazon)
	7. warehouse management system
	8. collaborative editor (e.g., Google Docs).
	9. proximity service (e.g., "find friends near me," Yelp).
	10. typeahead/autocomplete service.
	11. Online Banking
	12. Stripe 
	13. Netflix, Amazon Prime
	14. Uber, Lyft
	15. Google Maps
	16. Youtube
	17. Bitly, TinyURL
	18. Dropbox
	19. On-Demand Delivery - Gopuff
	20. WhatsApp
	21. Leetcode (leaderboard)
	22. Tinder
	23. Facebook Newsfeed, Twitter feed
	24. Ticketmaster, bookmyshow
	25. fb post search
	26. fb live comments